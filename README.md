# Creating a Honeynet & SOC in Azure 
![SOC_Honeynet_Map](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/145f5f20-ae14-4f1f-9185-22bf2bab1857)


## Introduction
In this Azure lab, I learned to create a honeynet in the cloud using virtual machines and azure services like Sentinel and Defender for Cloud.  The goal in completing this lab was to create an environment in which attackers could get into the network, record their IPs and map them, and then harden the network again to finish off the project.  The logs generated by these attackers would be recorded and used to create workbook maps, incidents in Sentinel, and security recommendations for Defender.

<h3><ins>Metrics Considered:</ins></h3>

- SecurityEvent (Windows Event Logs)
- Syslog (Linux Event Logs)
- SecurityAlert (Log Analytics Alerts Triggered)
- SecurityIncident (Incidents created by Sentinel)
- AzureNetworkAnalytics_CL (Malicious Flows allowed into our honeynet)

## Architecture Before Hardening & Implementing Security Controls
![Before_Hardening](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/abc3757c-b8d0-475b-b3f4-30cbcfd86e4f)
At the start of this project all resources were made accessible to the internet.  Both of the Network Security Group firewall ports for the Virtual Machines were left wide open.  Private Endpoints were not used, making it public and exposed to the internet.  That means attackers possibly getting into VMs, our blob storage, key vault, and more.

## Architecture After Hardening & Implementing Security Controls
![After_Hardening](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/b11e5282-5167-4655-94db-62e706978cd0)
At the end of this project, all the Network Security Groups were hardened and the VMs were only accessible to my host computer.  The other resources being the Key Vault and Blob Storage were protected by Private Endpoint Protection and their built-in firewalls.

<h3><ins>Architecture:</ins></h3>

- Virtual Network (VNet)
- Network Security Group (NSG)
- Virtual Machines (2 windows, 1 linux)
- Log Analytics Workspace
- Azure Active Directory/ Activity Logs
- Azure Key Vault
- Azure Storage Account

<h3><ins>Azure Services/Regulations:</ins></h3>

- Sentinel &#8594; Used to create Data Collection Rules and monitor Incidents.
- Defender &#8594; Used to create Workbook IPGeodata Maps, and implement Regulatory Compliance standards.
- NIST SP 800 53 R4 &#8594; Regulatory compliance standard that provides guidance for securing your environment.
- PCI DSS 4 &#8594; Credit card security standard that helps to protect user information.

## Hardening Approach

<kbd>![Screenshot 2023-07-23 193435](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/a67c0213-50e1-450b-9c03-1070c1f03ef8)</kbd>
- This screenshot displays the network topology after hardening. Only missing the subnet in this screenshot.

<kbd>![Screenshot 2023-07-23 193155](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/c4b5af56-e9d8-4218-a9e4-199064215be8)</kbd>
- This screenshot displays an overview of the Regulatory Compliance section in Microsoft Defender for Cloud.
  
<kbd>![Screenshot 2023-07-23 193131](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/c7827c4e-7100-434c-bcd5-a2341695d776)</kbd>
- This screenshot displays the section of NIST SP 800-53 that was implemented.



## Attack Maps Before Hardening & Implementing Security Controls

- This attack map below displays the traffic allowed into the network by having the Network Security Group ports open.
<kbd>![(before)nsg-malicious-allowed-in](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/e8fcb175-eb9a-4a27-8f79-4cfe60a92683)</kbd>

- This attack map below displays the attackers that tried to login to the Windows Virtual Machine.
<kbd>![(before)windows-rdp-smb-auth-fail](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/bf5cb7de-3681-4eeb-afac-afefbb483ae6)</kbd>

- This attack map below displays the SQL Server and the attackers that tried to get into it.
<kbd>![(before)mssql-auth-fail](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/e97d22b1-78cc-4c53-b0d7-31b2ea00bb47)</kbd>

- This attack map below displays the Linux Virtual Machine and the attackers that tried to access it.
<kbd>![(before)syslog-ssh-auth-fail](https://github.com/NathanRelph/Azure-Honeynet/assets/140288097/30b92af3-03e1-474d-9aba-070fd1163713)</kbd>




## Metrics Before Hardening & Implementing Security Controls

The following table shows the metrics we measured in our insecure environment for 24 hours:
- Start Time: 7/20/2023, 7:18:30 PM
- Stop Time: 7/21/2023, 7:18:30 PM

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 21129
| Syslog                   | 2005
| SecurityAlert            | 1
| SecurityIncident         | 243
| AzureNetworkAnalytics_CL | 1714

## Metrics After Hardening & Implementing Security Controls

The following table shows the metrics we measured in our environment for another 24 hours, but after we have applied security controls:
- Start Time: 7/22/2023, 5:32:05 PM 
- Stop Time: 7/23/2023, 5:32:05 PM

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 9162
| Syslog                   | 2
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion

Text here.

Also, [here](https://youtu.be/PvvVZGii2TY?t=0) are some parts of the lab I recorded so I could get some extra practice. Overall this was a great experience to go through this lab.  I learned a lot about logging, kql, and how to use azure services in a practical way.
